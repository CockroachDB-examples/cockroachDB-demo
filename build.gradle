buildscript {
    dependencies {
        classpath("org.flywaydb:flyway-database-postgresql:${flywayVersion}")
    }
}

plugins {
    id 'application'
    id "com.github.ben-manes.versions" version "${versionPluginVersion}"
    id "org.flywaydb.flyway" version "${flywayVersion}"
}

repositories {
    mavenCentral()
}

dependencies {
    implementation "org.postgresql:postgresql:${postgresVersion}"
    testImplementation "org.junit.jupiter:junit-jupiter-engine:${junitVersion}"

}

application {
    mainClass = 'com.example.cockroachdb.App'
    applicationDefaultJvmArgs = ['-Djdk.tls.client.protocols=TLSv1.2',
                                 "-DcockroachDBCluster=${cockroachDBCluster}",
                                 "-DcockroachDBPort=${cockroachDBPort}",
                                 "-DcockroachDBDatabase=${cockroachDBDatabase}",
                                 "-DcockroachDBUser=${cockroachDBUser}",
                                 "-DcockroachDBPassword=${cockroachDBPassword}"
                                ]
}

run.dependsOn flywayMigrate

flyway {
    url = "jdbc:postgresql://${cockroachDBCluster}:${cockroachDBPort}/${cockroachDBDatabase}?sslmode=verify-full"
    user = "${cockroachDBUser}"
    password = "${cockroachDBPassword}"
}

test {
    useJUnitPlatform()
    jvmArgs = [
                "-DcockroachDBCluster=${cockroachDBCluster}",
                "-DcockroachDBPort=${cockroachDBPort}",
                "-DcockroachDBDatabase=${cockroachDBDatabase}",
                "-DcockroachDBUser=${cockroachDBUser}",
                "-DcockroachDBPassword=${cockroachDBPassword}"
    ]
}